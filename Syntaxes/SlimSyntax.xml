<?xml version="1.0"?>
<syntax name="language-root.slim">

    <zones>
        <include collection="tags" />
		<include collection="nested-tags" />          
		<include collection="nested-static" />
		<include collection="tag-attributes" />   
        <include collection="strings" />
        <include collection="entities" />
    </zones>
    
    
    <library>	
    	<collection name="tags">
	        <zone name="tag.block.slim">
    			<expression>^(address|article|aside|audio|blockquote|body|canvas|caption|center|colgroup|dd|details|dir|div|dl|dt|embed|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hgroup|html|iframe|li|map|menu|noframes|noscript|object|ol|output|p|pre|progress|samp|section|table|tbody|td|textarea|tfoot|th|thead|title|tr|ul|video)( [\w+]=".")</expression>
    			<capture number="1" name="entity.name"/>
	        </zone>
	        
	        <zone name="tag.inline.slim">
				<expression>^(a|abbr|acronym|big|cite|code|dfn|command|em|font|i|kbd|mark|meter|nav|q|s|small|span|strike|strong|sub|summary|sup|time|tt|u|var)\b</expression>
				<capture number="1" name="entity.name"/>
	        </zone>
	        
	        <zone name="tag.shortcut.slim">
	        	<expression>^([#|\.])(\w+)(?:([#|\.])(\w+))*</expression>
				<capture number="1" name="punctuation.definition"/>
				<capture number="2" name="entity.name"/>
	        </zone>
	        
	        <zone name="tag.filter.keyword.slim">
	        		<expression>^(\w+)(:\s)</expression>
	        		<capture number="1" name="entity.name"/>
	        		<capture number="2" name="punctuation.definition"/>
	        </zone>
	        
	        <zone name="tag.other.slim">
	        		<expression>^(?!\-)([a-zA-Z0-9:_-]+)</expression>
	        		<capture number="1" name="entity.name"/>
	        </zone> 
        </collection>
                
        <collection name="nested-tags">
        	<zone name="tag.block.slim">
        		<expression>^(?:[\s*]+)(address|article|aside|audio|blockquote|body|canvas|caption|center|colgroup|dd|details|dir|div|dl|dt|embed|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hgroup|html|iframe|li|map|menu|noframes|noscript|object|ol|output|p|pre|progress|samp|section|table|tbody|td|textarea|tfoot|th|thead|title|tr|ul|video)( [\w+]=".")</expression>
        		<capture number="1" name="entity.name"/>
        	</zone>
        	
        	<zone name="tag.inline.slim">
        		<expression>^(?:[\s*]+)(a|abbr|acronym|big|cite|code|dfn|command|em|font|i|kbd|mark|meter|nav|q|s|small|span|strike|strong|sub|summary|sup|time|tt|u|var)\b</expression>
        		<capture number="1" name="entity.name"/>
        	</zone>
        	
        	<zone name="tag.shortcut.slim">
        		<expression>^(?:[\s*]+)([#|\.])(\w+)(?:([#|\.])(\w+))*</expression>
        		<capture number="1" name="punctuation.definition"/>
        		<capture number="2" name="entity.name"/>
        	</zone>
        	
        	<zone name="tag.filter.keyword.slim">
        			<expression>^(?:[\s*]+)(\w+)(:\s)</expression>
        			<capture number="1" name="entity.name"/>
        			<capture number="2" name="punctuation.definition"/>
        	</zone>
        	
        	<zone name="tag.other.slim">
        			<expression>^(?:[\s*]+)(?!\-)([a-zA-Z0-9:_-]+)</expression>
        			<capture number="1" name="entity.name"/>
        	</zone>
        </collection>
        
        <collection name="nested-static">
        	<zone>
        		<expression>^(?:[\s*]+)(\| |' )</expression>
        		<capture number="1" name="punctuation.definition" />
        	</zone>
        </collection>
        
        <collection name="tag-attributes">
        	<!--CSS embedded attributes-->
        	<zone>
        		<expression>\s+(style)(=)((")([^"]*)("))</expression>
        		<capture number="1" name="attribute-name.style"/>
        		<capture number="2" name="punctuation.separator.attribute"/>
        		<capture number="3" name="string.quoted.double"/>
        		<capture number="4" name="punctuation.definition.begin"/>
        		<capture number="5" name="embedded.property-list.css">
        			<subzones>
        				<include syntax="language-root.css" collection="properties"/>
        			</subzones>
        		</capture>
        		<capture number="6" name="punctuation.definition.end"/>
        	</zone>
        	<zone>
        		<expression>\s+(style)(=)((')([^']*)('))</expression>
        		<capture number="1" name="attribute-name.style"/>
        		<capture number="2" name="punctuation.separator.attribute"/>
        		<capture number="3" name="string.quoted.single"/>
        		<capture number="4" name="punctuation.definition.begin"/>
        		<capture number="5" name="embedded.property-list.css">
        			<subzones>
        				<include syntax="language-root.css" collection="properties"/>
        			</subzones>
        		</capture>
        		<capture number="6" name="punctuation.definition.end"/>
        	</zone>
        	<!--Javascript embedded attributes-->
        	<zone>
        		<expression>\s+(on[a-zA-Z]+)(=)((")(.*?)((?&lt;!\\)"))</expression>
        		<capture number="1" name="attribute-name.js"/>
        		<capture number="2" name="punctuation.separator.attribute"/>
        		<capture number="3" name="string.quoted.double"/>
        		<capture number="4" name="punctuation.definition.begin"/>
        		<capture number="5" name="embedded.sourcecode.js">
        			<subzones>
        				<include syntax="language-root.js"/>
        			</subzones>
        		</capture>
        		<capture number="6" name="punctuation.definition.end"/>
        	</zone>
        	<zone>
        		<expression>\s+(on[a-zA-Z]+)(=)((')(.*?)((?&lt;!\\)'))</expression>
        		<capture number="1" name="attribute-name.js"/>
        		<capture number="2" name="punctuation.separator.attribute"/>
        		<capture number="3" name="string.quoted.single"/>
        		<capture number="4" name="punctuation.definition.begin"/>
        		<capture number="5" name="embedded.sourcecode.js">
        			<subzones>
        				<include syntax="language-root.js"/>
        			</subzones>
        		</capture>
        		<capture number="6" name="punctuation.definition.end"/>
        	</zone>
        	<!--Generic attributes-->
            <zone>
                <expression>\s+([-_a-zA-Z0-9:]+)(=)</expression>
                <capture number="1" name="attribute-name">
        			<subzones>
        				<zone>
        					<expression>([^:]+)(:)(.*)</expression>
        					<capture number="1" name="namespace"/>
        					<capture number="2" name="punctuation.separator"/>
        					<capture number="3" name="localname"/>
        				</zone>
        			</subzones>
        		</capture>
                <capture number="2" name="punctuation.separator.attribute"/>
                <capture number="3" name="punctuation.separator.namespace"/>
            </zone>
            <include collection="strings"/>
        </collection>
        
        <collection name="strings">
            <zone name="attribute-value.string.quoted.double">
                <starts-with>
                    <expression>"</expression>
                    <capture number="0" name="punctuation.definition.begin"/>
                </starts-with>
                <ends-with>
                    <expression>"</expression>
                    <capture number="0" name="punctuation.definition.end"/>
                </ends-with>
        		<subzones name="attribute-value.value" />
            </zone>
            <zone name="attribute-value.string.quoted.single">
                <starts-with>
                    <expression>'</expression>
                    <capture number="0" name="punctuation.definition.begin"/>
                </starts-with>
                <ends-with>
                    <expression>'</expression>
                    <capture number="0" name="punctuation.definition.end"/>
                </ends-with>
        		<subzones name="attribute-value.value" />
            </zone>
        </collection>
        
        <collection name="entities">
        	<zone name="constant.character.entity.slim">
        		<expression>(&amp;)([a-zA-Z0-9]+|#[0-9]+|#x[0-9a-fA-F]+)(;)</expression>
        		<capture number="1" name="punctuation.definition.entity.html"/>
        		<capture number="3" name="punctuation.definition.entity.html"/>
        	</zone>
        	<zone name="invalid.illegal.bad-ampersand.slim">
        		<expression>&amp;</expression>
        	</zone>
        </collection>
        
        
    </library>
    
</syntax>